<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FFC6D9">
    <title>Bonnie's Magic Claw Machine</title>
    <!-- Using Fredoka One for that rounded, playful Toca vibe -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Default (Indoor) Palette */
            --bg-color: #E0F7FA;
            --machine-color: #FF8BA7;
            --machine-dark: #FF6B8B;
            --accent-yellow: #FFEF96;
            --accent-blue: #AEE1FF;
            --accent-purple: #D4A5FF;
            --bg-pattern-color-1: #AEE1FF;
            --bg-pattern-color-2: #D4A5FF;
        }

        /* OUTDOOR THEME OVERRIDES */
        body.outdoor {
            --bg-color: #87CEEB; /* Sky Blue */
            --machine-color: #FFCC80; /* Apricot */
            --machine-dark: #FB8C00; /* Darker Orange */
            --accent-yellow: #FFF59D;
            --accent-blue: #81D4FA;
            --accent-purple: #A5D6A7; /* Green accents */
        }

        body {
            background-color: var(--bg-color);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Nunito', sans-serif;
            overflow: hidden;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.5s ease;
        }

        /* --- BACKGROUND SCENERY LAYERS --- */
        .scenery-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; /* Behind machine */
            pointer-events: none;
            overflow: hidden;
        }

        /* Indoor Elements (Polka Dots) */
        .indoor-bg {
            background-image: radial-gradient(var(--bg-pattern-color-1) 15%, transparent 16%),
                              radial-gradient(var(--bg-pattern-color-2) 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            opacity: 1;
            transition: opacity 0.5s;
        }
        body.outdoor .indoor-bg { opacity: 0; }

        /* Outdoor Elements */
        .outdoor-bg {
            opacity: 0;
            transition: opacity 0.5s;
        }
        body.outdoor .outdoor-bg { opacity: 1; }

        .grass {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 150px;
            background: #AED581;
            border-top: 10px solid #81C784;
            border-radius: 50% 50% 0 0 / 20px 20px 0 0;
        }
        .sun {
            position: absolute; top: 50px; left: 20px;
            width: 80px; height: 80px;
            background: #FFEB3B;
            border-radius: 50%;
            box-shadow: 0 0 40px #FFF176;
            animation: sunPulse 4s infinite alternate;
        }
        .cloud {
            position: absolute;
            background: #fff; border-radius: 50px;
            opacity: 0.8;
        }
        .c1 { width: 100px; height: 40px; top: 80px; right: 20px; animation: float 6s infinite ease-in-out; }
        .c2 { width: 80px; height: 30px; top: 150px; left: -20px; animation: float 8s infinite ease-in-out reverse; }

        /* --- CUSTOM ANIMALS --- */
        .animal-container {
            position: absolute;
            bottom: 140px;
            z-index: 2;
        }

        /* BUNNY */
        .bunny-wrapper {
            left: 10%;
            /* Slower, less frantic hop */
            animation: hop 5s infinite ease-in-out; 
        }
        .bunny-body {
            width: 50px; height: 40px;
            background: #fff; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: relative;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .bunny-head {
            position: absolute; top: -20px; left: -5px;
            width: 35px; height: 35px; background: #fff;
            border-radius: 50%;
        }
        /* Face Features */
        .bunny-eye { position: absolute; top: 12px; left: 8px; width: 4px; height: 4px; background: #333; border-radius: 50%; }
        .bunny-nose { position: absolute; top: 16px; left: 2px; width: 4px; height: 3px; background: #FFC6D9; border-radius: 50%; }

        .bunny-ear {
            position: absolute; top: -25px; width: 10px; height: 30px;
            background: #fff; border-radius: 50px;
            border: 2px solid #fff; 
        }
        .bunny-ear.left { left: 5px; transform: rotate(-10deg); }
        .bunny-ear.right { right: 5px; transform: rotate(10deg); }
        .bunny-ear::after {
            content:''; position: absolute; top: 5px; left: 2px;
            width: 6px; height: 20px; background: #FFC6D9; border-radius: 50px;
        }
        .bunny-tail {
            position: absolute; right: -5px; bottom: 5px;
            width: 15px; height: 15px; background: #fff;
            border-radius: 50%;
        }

        /* BIRD */
        .bird-wrapper {
            right: 15%;
            bottom: 160px;
            animation: fly 4s infinite ease-in-out alternate;
        }
        .bird-body {
            width: 40px; height: 35px;
            background: #4FC3F7;
            border-radius: 50% 50% 20% 20%;
            position: relative;
        }
        .bird-wing {
            position: absolute; top: 15px; left: -5px;
            width: 25px; height: 15px;
            background: #29B6F6;
            border-radius: 50% 50% 0 50%;
            transform: rotate(-10deg);
        }
        .bird-beak {
            position: absolute; top: 12px; right: -6px;
            width: 0; height: 0;
            border-left: 8px solid #FF9800;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }
        .bird-eye {
            position: absolute; top: 10px; right: 8px;
            width: 4px; height: 4px; background: #333;
            border-radius: 50%;
        }
        .bird-leg {
            position: absolute; bottom: -8px; width: 2px; height: 8px;
            background: #333;
        }
        .bird-leg.l { left: 15px; }
        .bird-leg.r { left: 25px; }

        @keyframes sunPulse { from { transform: scale(1); } to { transform: scale(1.1); } }
        @keyframes float { 0% { transform: translateX(0); } 50% { transform: translateX(20px); } 100% { transform: translateX(0); } }
        /* Adjusted hop to be a quick hop then wait */
        @keyframes hop { 
            0%, 10%, 20% { transform: translateY(0); } 
            15% { transform: translateY(-15px); } 
            100% { transform: translateY(0); }
        }
        @keyframes fly { 
            0% { transform: translateY(0) rotate(0deg); } 
            100% { transform: translateY(-10px) rotate(5deg); } 
        }


        /* --- THE GACHA MACHINE --- */
        .gacha-machine {
            position: relative;
            width: 360px;
            height: 680px; 
            background: var(--machine-color);
            border-radius: 80px 80px 40px 40px;
            box-shadow: 
                inset -10px -10px 0 rgba(0,0,0,0.1),
                0 20px 40px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 25px;
            box-sizing: border-box;
            z-index: 10;
            transition: background-color 0.5s;
            
            /* Floral Pattern */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Cpath fill='rgba(255,255,255,0.25)' d='M30 10 C35 10 40 15 40 20 C45 20 50 25 50 30 C50 35 45 40 40 40 C40 45 35 50 30 50 C25 50 20 45 20 40 C15 40 10 35 10 30 C10 25 15 20 20 20 C20 15 25 10 30 10 Z'/%3E%3Ccircle cx='30' cy='30' r='8' fill='rgba(255,239,150,0.4)'/%3E%3C/svg%3E");
            background-size: 50px 50px;
        }

        /* Decorative "Ears" */
        .gacha-machine::before {
            content: '';
            position: absolute;
            top: -15px; left: 60px;
            width: 30px; height: 30px;
            background: var(--accent-yellow);
            border-radius: 50%;
            box-shadow: 210px 0 0 var(--accent-yellow);
            transition: background-color 0.5s, box-shadow 0.5s;
        }

        /* --- HEADER AREA --- */
        .header-plate {
            background: #fff;
            padding: 12px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
            transform: rotate(-1deg);
            margin-bottom: 20px; 
            border: 4px solid var(--accent-purple);
            text-align: center;
            width: 80%;
            transition: border-color 0.5s;
        }

        .header-plate h1 {
            font-family: 'Fredoka One', cursive;
            color: var(--machine-dark);
            font-size: 1.1rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.2;
            transition: color 0.5s;
        }

        /* --- FLOATING JOURNAL BUTTON --- */
        .journal-floater {
            position: absolute;
            top: 20px; right: 20px;
            width: 70px; height: 85px;
            cursor: pointer; z-index: 50;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform: rotate(5deg);
        }
        .journal-floater:hover { transform: rotate(0deg) scale(1.1); }
        .journal-floater:active { transform: rotate(0deg) scale(0.95); }

        .journal-book {
            width: 100%; height: 100%;
            background: var(--accent-purple);
            border-radius: 8px 15px 15px 8px;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.15);
            position: relative;
            border: 3px solid #fff;
            box-sizing: border-box;
            transition: background-color 0.5s;
        }
        
        .journal-spine {
            position: absolute; left: 0; top: 0; bottom: 0; width: 12px;
            background: rgba(0,0,0,0.1);
            border-right: 2px dashed rgba(255,255,255,0.5);
            border-radius: 5px 0 0 5px;
        }
        .journal-label {
            position: absolute; top: 50%; left: 55%;
            transform: translate(-50%, -50%); font-size: 2rem;
        }

        /* --- THE GLASS DOME --- */
        .glass-dome {
            width: 280px; height: 300px;
            background: linear-gradient(180deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.4) 100%);
            border-radius: 140px 140px 40px 40px;
            position: relative; overflow: hidden;
            border: 8px solid rgba(255,255,255,0.6);
            box-shadow: inset 10px 10px 20px rgba(0,0,0,0.05);
            margin-bottom: 15px; flex-shrink: 0;
        }
        .reflection {
            position: absolute; top: 40px; right: 40px;
            width: 30px; height: 60px;
            background: rgba(255,255,255,0.8);
            border-radius: 20px;
            transform: rotate(25deg);
            z-index: 20; pointer-events: none;
        }

        /* --- CAPSULES --- */
        .capsule {
            position: absolute; width: 54px; height: 54px;
            border-radius: 50%;
            border: 3px solid rgba(0,0,0,0.1);
            box-sizing: border-box;
            box-shadow: 2px 4px 8px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.3s ease;
        }
        .capsule::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%;
            background: rgba(255,255,255,0.4); border-radius: 50px 50px 0 0;
        }

        /* --- THE ROBOT CLAW --- */
        .claw-arm {
            position: absolute; top: -150px; left: 50%;
            transform: translateX(-50%); width: 80px; z-index: 15;
            transition: top 1.5s cubic-bezier(0.45, 0, 0.55, 1);
            filter: drop-shadow(0 5px 0 rgba(0,0,0,0.1));
            display: flex; flex-direction: column; align-items: center;
        }
        .claw-rope { width: 6px; height: 120px; background: #555; border-radius: 4px; }
        .claw-body { width: 50px; height: 30px; background: var(--accent-yellow); margin-top: -5px; border-radius: 10px; position: relative; border: 3px solid #555; z-index: 2; transition: background-color 0.5s; }
        .claw-fingers { display: flex; justify-content: space-between; width: 60px; margin-top: -5px; position: relative; }
        .finger {
            width: 12px; height: 35px; background: #aaa;
            border-radius: 0 0 10px 10px; border: 3px solid #555;
            transition: transform 0.5s;
        }
        .finger.left { transform-origin: top right; transform: rotate(-15deg); }
        .finger.right { transform-origin: top left; transform: rotate(15deg); }
        .held-capsule {
            width: 50px; height: 50px; border-radius: 50%;
            border: 3px solid rgba(0,0,0,0.1); box-sizing: border-box;
            position: absolute; top: 25px; left: 50%; transform: translateX(-50%);
            z-index: 1; display: none;
            transition: top 0.5s cubic-bezier(0.6, 0.04, 0.98, 0.335);
        }
        .held-capsule::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%;
            background: rgba(255,255,255,0.4); border-radius: 50px 50px 0 0;
        }
        .claw-arm.grabbing .finger.left { transform: rotate(20deg); }
        .claw-arm.grabbing .finger.right { transform: rotate(-20deg); }
        .claw-arm.dropping { top: 60px; }
        .claw-arm.retracting { top: -150px; }
        .held-capsule.falling { top: 450px !important; }

        /* --- CONTROLS --- */
        .control-area {
            width: 100%; height: 140px;
            background: rgba(255,255,255,0.2);
            border-radius: 30px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 25px; box-sizing: border-box;
            border: 4px solid rgba(255,255,255,0.5);
        }
        .prize-chute {
            width: 80px; height: 80px; background: #333;
            border-radius: 15px 15px 40px 40px;
            box-shadow: inset 0 10px 20px #000;
            position: relative; border: 4px solid #555; z-index: 15;
        }
        .prize-chute::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 60%;
            background: linear-gradient(180deg, #444 0%, #222 100%);
            transform-origin: top; transform: rotateX(20deg);
            border-bottom: 2px solid #111; z-index: 1;
        }
        .chute-prize {
            width: 54px; height: 54px; border-radius: 50%;
            border: 3px solid rgba(0,0,0,0.1);
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.2), 5px 5px 15px rgba(0,0,0,0.3);
            position: absolute; bottom: 5px; left: 50%;
            transform: translateX(-50%); cursor: pointer; z-index: 20;
            animation: bounceIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .chute-prize::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%;
            background: rgba(255,255,255,0.4); border-radius: 50px 50px 0 0;
        }
        .chute-prize.waiting { animation: pulse 1.5s infinite; }
        
        .center-console { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .token-lcd {
            background: #222; color: #76ff03;
            font-family: 'Courier New', monospace; font-weight: bold;
            font-size: 1.2rem; padding: 5px 12px;
            border-radius: 5px; border: 3px solid #555;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.8); letter-spacing: 2px;
        }
        .token-label { font-family: 'Fredoka One'; font-size: 0.7rem; color: #fff; opacity: 0.8; letter-spacing: 1px; }

        .play-btn {
            width: 80px; height: 80px; background: var(--accent-yellow);
            border: 4px solid #fff; border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 8px 0 #d9c445, 0 15px 20px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.1s, box-shadow 0.1s, background-color 0.5s;
        }
        body.outdoor .play-btn { box-shadow: 0 8px 0 #d9c025, 0 15px 20px rgba(0,0,0,0.2); }

        .play-btn:active { transform: translateY(6px); box-shadow: 0 2px 0 #d9c445, 0 5px 10px rgba(0,0,0,0.2); }
        .play-btn:disabled { filter: grayscale(1); cursor: not-allowed; }
        .play-btn svg { width: 35px; height: 35px; fill: #FF9E00; }

        /* --- INTRO SCREEN --- */
        .intro-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #FFC6D9;
            z-index: 500;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .intro-screen.hidden { transform: translateY(-100%); pointer-events: none; }
        
        .intro-card {
            background: #fff; padding: 40px 30px;
            border-radius: 30px; text-align: center;
            box-shadow: 0 20px 0 rgba(0,0,0,0.1);
            max-width: 320px; width: 100%;
        }
        .intro-card h1 { font-family: 'Fredoka One'; color: #FF6B8B; margin-bottom: 30px; font-size: 1.8rem; line-height: 1.4; }
        
        .mode-btn {
            display: block; width: 100%; margin: 15px 0;
            padding: 20px; border: none; border-radius: 20px;
            font-family: 'Fredoka One'; font-size: 1.2rem;
            cursor: pointer; text-transform: uppercase;
            transition: transform 0.1s;
        }
        .mode-btn:active { transform: scale(0.96); }
        
        .btn-indoor { background: #E0F7FA; color: #00838F; border: 4px solid #B2EBF2; }
        .btn-outdoor { background: #E8F5E9; color: #2E7D32; border: 4px solid #C8E6C9; }


        /* --- MODAL / RESULT --- */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            z-index: 100; display: none;
            justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
        }
        .card {
            background: #fff; width: 90%; max-width: 320px;
            max-height: 80vh; /* Limit height */
            border-radius: 30px; padding: 30px 20px;
            text-align: center; position: relative;
            transform: scale(0.5) rotate(-10deg); opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 6px solid var(--accent-blue);
            display: flex; flex-direction: column;
        }
        .modal-overlay.active { display: flex; }
        .modal-overlay.active .card { transform: scale(1) rotate(0deg); opacity: 1; }
        
        /* CONTENT SCROLL AREA */
        .activity-details {
            overflow-y: auto;
            margin-bottom: 15px;
            text-align: left;
            padding: 0 10px;
            border-top: 2px dashed #eee;
            border-bottom: 2px dashed #eee;
            max-height: 300px; /* Scroll if long */
        }
        .activity-details p {
            font-size: 1rem; color: #666; font-family: 'Nunito'; line-height: 1.4;
            margin: 10px 0;
        }
        .checklist { list-style: none; padding: 0; margin: 10px 0; }
        .checklist li {
            font-family: 'Nunito'; color: #444; font-size: 0.95rem;
            margin-bottom: 8px; position: relative; padding-left: 20px;
        }
        .checklist li::before {
            content: '‚òê'; position: absolute; left: 0; color: var(--accent-blue); font-weight: bold;
        }

        .card-icon { font-size: 3rem; margin-bottom: 10px; display: block; animation: bounce 1s infinite; }
        .card h2 { font-family: 'Fredoka One'; color: var(--machine-dark); margin: 0 0 5px 0; font-size: 1.1rem; transition: color 0.5s; text-transform: uppercase; }
        .card h3 { font-size: 1.3rem; font-weight: 800; color: #555; margin: 0 0 10px 0; line-height: 1.2; font-family: 'Nunito'; }
        
        .btn-col { display: flex; flex-direction: column; gap: 15px; align-items: center; width: 100%; margin-top: auto;}
        .action-btn {
            border: none; padding: 15px 0; width: 100%;
            border-radius: 15px; font-family: 'Fredoka One';
            font-size: 1rem; cursor: pointer; text-transform: uppercase;
            transition: transform 0.2s;
        }
        .action-btn:active { transform: scale(0.95); }
        .btn-retry {
            background: transparent; color: #888;
            padding: 5px; font-size: 0.9rem;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .retry-subtext { font-family: 'Nunito', sans-serif; font-size: 0.8rem; opacity: 0.7; background: #f0f0f0; padding: 4px 10px; border-radius: 10px; }
        .btn-accept {
            background: var(--accent-blue); color: #005680;
            box-shadow: 0 4px 0 #7ec4ef; font-size: 1.1rem;
            transition: background-color 0.5s, color 0.5s;
        }
        body.outdoor .btn-accept { box-shadow: 0 4px 0 #4DB6AC; color: #004D40; }

        /* --- JOURNAL MODAL --- */
        .journal-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 110; display: flex;
            flex-direction: column; transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
        }
        .journal-modal.open { transform: translateY(0); }
        .journal-header {
            background: var(--accent-purple); padding: 20px;
            display: flex; justify-content: space-between; align-items: center;
            transition: background-color 0.5s;
        }
        .journal-header h2 { margin: 0; color: #fff; font-family: 'Fredoka One'; }
        .close-journal { background: none; border: none; font-size: 2rem; color: #fff; cursor: pointer; }
        .journal-content { flex: 1; padding: 20px; overflow-y: auto; background: #F9F9F9; }
        .journal-entry {
            background: #fff; border-radius: 15px; padding: 15px;
            margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 5px solid var(--accent-yellow);
        }
        .entry-title { font-weight: 800; font-size: 1.1rem; color: #555; }
        .entry-date { font-size: 0.8rem; color: #999; margin-bottom: 8px; }
        .star-rating { color: #FFD700; font-size: 1.2rem; cursor: pointer; }
        .journal-note {
            width: 100%; border: 1px solid #eee; border-radius: 8px;
            padding: 8px; font-family: 'Nunito'; font-size: 0.9rem;
            margin-top: 10px; box-sizing: border-box; resize: none;
        }

        /* --- KEYFRAMES --- */
        @keyframes bounceIn { 0% { transform: translateX(-50%) scale(0) rotate(180deg); opacity: 0; } 60% { transform: translateX(-50%) scale(1.1) rotate(0deg); opacity: 1; } 100% { transform: translateX(-50%) scale(1) rotate(0deg); opacity: 1; } }
        @keyframes pulse { 0% { transform: translateX(-50%) scale(1); } 50% { transform: translateX(-50%) scale(1.1); } 100% { transform: translateX(-50%) scale(1); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    </style>
</head>
<body>

    <!-- SCENERY LAYER -->
    <div class="scenery-layer">
        <div class="indoor-bg scenery-layer"></div>
        <div class="outdoor-bg scenery-layer">
            <div class="sun"></div>
            <div class="cloud c1"></div>
            <div class="cloud c2"></div>
            <div class="grass"></div>
            
            <div class="animal-container bunny-wrapper">
                <div class="bunny-head">
                    <div class="bunny-eye"></div>
                    <div class="bunny-nose"></div>
                    <div class="bunny-ear left"></div>
                    <div class="bunny-ear right"></div>
                </div>
                <div class="bunny-body">
                    <div class="bunny-tail"></div>
                </div>
            </div>

            <div class="animal-container bird-wrapper">
                <div class="bird-body">
                    <div class="bird-wing"></div>
                    <div class="bird-beak"></div>
                    <div class="bird-eye"></div>
                    <div class="bird-leg l"></div>
                    <div class="bird-leg r"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- INTRO SCREEN -->
    <div class="intro-screen" id="introScreen">
        <div class="intro-card">
            <h1>Hi Bonnie!<br>Where are we playing today?</h1>
            <button class="mode-btn btn-indoor" onclick="selectMode('indoor')">üè† Inside</button>
            <button class="mode-btn btn-outdoor" onclick="selectMode('outdoor')">üå≥ Outside</button>
        </div>
    </div>

    <!-- Floating Journal Button -->
    <div class="journal-floater" onclick="toggleJournal()">
        <div class="journal-book">
            <div class="journal-spine"></div>
            <div class="journal-label">‚úèÔ∏è</div>
        </div>
    </div>

    <div class="gacha-machine">
        
        <div class="header-plate">
            <h1>Bonnie's Magic Claw Machine</h1>
        </div>

        <!-- The Glass Display -->
        <div class="glass-dome" id="dome">
            <div class="reflection"></div>
            <!-- Capsules injected via JS -->
            
            <!-- The Claw -->
            <div class="claw-arm" id="claw">
                <div class="claw-rope"></div>
                <div class="claw-body"></div>
                <div class="claw-fingers">
                    <div class="finger left"></div>
                    <div class="finger right"></div>
                    <!-- The visual "held" capsule inside the claw -->
                    <div class="held-capsule" id="heldCapsule"></div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="control-area">
            <!-- Left: Prize Chute -->
            <div class="prize-chute" id="prizeChute"></div>

            <!-- Center: Token Display -->
            <div class="center-console">
                <div class="token-lcd" id="token-count">05</div>
                <div class="token-label">TOKENS</div>
            </div>
            
            <!-- Right: Play Button -->
            <button class="play-btn" id="playBtn" onclick="playGame()">
                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </button>
        </div>
    </div>

    <!-- Result Modal -->
    <div class="modal-overlay" id="modal">
        <div class="card" id="resultCard">
            <span class="card-icon">üéÅ</span>
            <h2 id="result-title">YOU GOT:</h2>
            <h3 id="activity-title">Activity Name</h3>
            
            <!-- NEW: Scrollable details area -->
            <div class="activity-details" id="activity-details">
                <!-- Content injected via JS -->
            </div>
            
            <div class="btn-col" id="modalBtns">
                <button class="action-btn btn-accept" onclick="accept()">Let's do it!</button>
                
                <button class="action-btn btn-retry" onclick="retry()">
                    <span>Try Again?</span>
                    <span class="retry-subtext" id="retry-tokens">4 tokens left</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Journal Modal -->
    <div class="journal-modal" id="journalModal">
        <div class="journal-header">
            <h2>My Journal ‚úèÔ∏è</h2>
            <button class="close-journal" onclick="toggleJournal()">√ó</button>
        </div>
        <div class="journal-content" id="journalList">
            <!-- Entries go here -->
            <div style="text-align:center; color:#999; margin-top:50px;">
                Complete missions to fill your journal!
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        // NEW STRUCTURE: { text, emoji, description, steps[] }
        
        const indoorActivities = [
            { 
                text: "Blanket Fort", 
                emoji: "üè∞", 
                description: "Transform the living room into a magical castle!",
                steps: [
                    "Gather all pillows and blankets",
                    "Use chairs to prop up the roof",
                    "Add fairy lights inside",
                    "Bring snacks into the fort",
                    "Read a book inside"
                ]
            },
            { 
                text: "Photo Scavenger Hunt", 
                emoji: "üì∏", 
                description: "Can you find and photograph all these items?",
                steps: [
                    "Something Blue",
                    "Something Round",
                    "A tiny toy",
                    "A funny face",
                    "Something soft",
                    "A plant"
                ]
            },
            { 
                text: "Learn a TikTok Dance", 
                emoji: "üíÉ",
                description: "Pick a fun song and learn the moves!",
                steps: []
            },
            { 
                text: "Comic Strip", 
                emoji: "üé®",
                description: "Draw a funny 3-panel comic.",
                steps: [
                    "Fold a paper into 3 sections",
                    "Draw character 1",
                    "Draw character 2",
                    "Add speech bubbles"
                ]
            },
            { 
                text: "Bake Mug Cakes", 
                emoji: "üßÅ",
                description: "Make a yummy cake in the microwave.",
                steps: [
                    "Mix flour and sugar",
                    "Add milk and oil",
                    "Microwave for 1 min",
                    "Let it cool!"
                ]
            }
        ];

        const outdoorActivities = [
            { 
                text: "Leaf Hunt", 
                emoji: "üçÅ", 
                description: "Find 3 different kinds of leaves in the garden.",
                steps: [
                    "Find a big leaf",
                    "Find a crunchy leaf",
                    "Find a green leaf"
                ]
            },
            { 
                text: "Sidewalk Chalk", 
                emoji: "üñçÔ∏è",
                description: "Create a masterpiece on the driveway.",
                steps: []
            },
            { 
                text: "Garden Race", 
                emoji: "üèÉ‚Äç‚ôÄÔ∏è",
                description: "Run 3 laps around the garden as fast as you can!",
                steps: []
            },
            { 
                text: "Daisy Chain", 
                emoji: "üåº",
                description: "Make a necklace out of flowers.",
                steps: [
                    "Pick gentle flowers with long stems",
                    "Make a slit in the stem",
                    "Thread the next flower through",
                    "Connect the ends"
                ]
            },
            { 
                text: "Bug Safari", 
                emoji: "üêû",
                description: "Find a bug, watch what it does, and give it a name!",
                steps: []
            }
        ];

        let currentActivities = indoorActivities; // Default
        let currentMode = 'indoor'; // Track mode

        const colors = ['#FF9AA2', '#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7', '#C7CEEA'];

        // --- STATE ---
        let tokens = 5;
        let currentActivity = null;
        let targetCapsuleElement = null;
        
        // Load Journal
        let journalEntries = JSON.parse(localStorage.getItem('morningMagicJournal')) || [];

        // Elements
        const dome = document.getElementById('dome');
        const claw = document.getElementById('claw');
        const heldCapsule = document.getElementById('heldCapsule');
        const playBtn = document.getElementById('playBtn');
        const tokenDisplay = document.getElementById('token-count');
        const modal = document.getElementById('modal');
        const activityTitle = document.getElementById('activity-title');
        const activityDetails = document.getElementById('activity-details');
        const cardIcon = document.querySelector('.card-icon');
        const resultCard = document.getElementById('resultCard');
        const retryTokensText = document.getElementById('retry-tokens');
        const prizeChute = document.getElementById('prizeChute');
        const introScreen = document.getElementById('introScreen');
        const resultTitle = document.getElementById('result-title');

        // --- MODE SELECTION ---
        function selectMode(mode) {
            currentMode = mode;
            if (mode === 'outdoor') {
                document.body.classList.add('outdoor');
                currentActivities = outdoorActivities;
            } else {
                document.body.classList.remove('outdoor');
                currentActivities = indoorActivities;
            }
            // Hide Intro
            introScreen.classList.add('hidden');
        }

        // --- INIT ---
        function fillMachine() {
            // Create capsules
            for(let i=0; i<15; i++) {
                let cap = document.createElement('div');
                cap.classList.add('capsule');
                
                // Random Style
                let bg = colors[Math.floor(Math.random() * colors.length)];
                cap.style.background = bg;
                cap.style.borderColor = adjustColor(bg, -20);
                
                // Random Position at bottom
                let left = Math.random() * 200 + 10; 
                let top = 220 + Math.random() * 50; 
                
                cap.style.left = left + 'px';
                cap.style.top = top + 'px';
                
                // Random Rotation
                let rot = Math.random() * 360;
                cap.style.transform = `rotate(${rot}deg)`;
                
                // Store color
                cap.dataset.color = bg;
                cap.dataset.border = adjustColor(bg, -20);

                dome.appendChild(cap);
            }
        }
        
        function adjustColor(color, amount) {
            return '#' + color.replace(/^#/, '').replace(/../g, color => ('0'+Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).substr(-2));
        }

        fillMachine();

        // --- GAME LOGIC ---
        function playGame() {
            if (tokens <= 0) {
                alert("Oh no! All out of tokens for today!");
                return;
            }

            playBtn.disabled = true;

            // 1. Identify random capsule
            const capsules = document.querySelectorAll('.capsule:not([style*="display: none"])');
            if(capsules.length === 0) {
                alert("Machine is empty!"); return;
            }
            targetCapsuleElement = capsules[Math.floor(Math.random() * capsules.length)];
            
            // Setup held capsule style
            heldCapsule.style.background = targetCapsuleElement.style.background;
            heldCapsule.style.borderColor = targetCapsuleElement.style.borderColor;
            heldCapsule.dataset.color = targetCapsuleElement.dataset.color;
            heldCapsule.dataset.border = targetCapsuleElement.dataset.border;

            // 2. Drop Claw
            claw.classList.add('dropping');
            claw.classList.add('grabbing'); 

            // 3. Grab
            setTimeout(() => {
                claw.classList.remove('grabbing');
                
                targetCapsuleElement.style.opacity = '0';
                heldCapsule.style.display = 'block';
                heldCapsule.style.top = '25px'; 
                heldCapsule.classList.remove('falling');

                document.querySelectorAll('.capsule').forEach(c => {
                    c.style.transform += ` translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;
                });
            }, 1000);

            // 4. Retract
            setTimeout(() => {
                claw.classList.remove('dropping');
                claw.classList.add('retracting');
            }, 2000);

            // 5. DROP IT
            setTimeout(() => {
                claw.classList.remove('grabbing'); 
                heldCapsule.classList.add('falling'); 
            }, 3600); 

            // 6. Appear in Chute
            setTimeout(() => {
                heldCapsule.style.display = 'none';
                spawnChutePrize(heldCapsule.dataset.color, heldCapsule.dataset.border);
            }, 4100); 
        }

        function spawnChutePrize(color, border) {
            prizeChute.innerHTML = '';

            const prize = document.createElement('div');
            prize.className = 'chute-prize waiting';
            prize.style.background = color;
            prize.style.borderColor = border;
            prize.onclick = function() {
                openPrize(this);
            };
            
            prizeChute.appendChild(prize);
        }

        function openPrize(element) {
            element.remove();
            showResult();
        }

        function showResult() {
            // Pick random activity based on CURRENT MODE
            currentActivity = currentActivities[Math.floor(Math.random() * currentActivities.length)];
            
            // Populate Modal
            activityTitle.innerText = currentActivity.text;
            cardIcon.innerText = currentActivity.emoji;
            
            // Populate Details
            let html = '';
            if (currentActivity.description) {
                html += `<p>${currentActivity.description}</p>`;
            }
            if (currentActivity.steps && currentActivity.steps.length > 0) {
                html += '<ul class="checklist">';
                currentActivity.steps.forEach(step => {
                    html += `<li>${step}</li>`;
                });
                html += '</ul>';
            }
            activityDetails.innerHTML = html;

            
            // DYNAMIC TITLE CHANGE
            if (currentMode === 'outdoor') {
                resultTitle.innerText = "OUTDOOR ADVENTURE:";
            } else {
                resultTitle.innerText = "INDOOR MISSION:";
            }
            
            retryTokensText.innerText = (tokens - 1) + " tokens left";
            resultCard.style.border = "6px solid var(--accent-blue)";
            document.getElementById('modalBtns').style.display = 'flex';
            
            modal.classList.add('active');
        }

        function retry() {
            if (tokens > 1) {
                tokens--;
                updateTokenDisplay();
                modal.classList.remove('active');
                
                // RESET
                heldCapsule.style.display = 'none';
                targetCapsuleElement.style.opacity = '1';
                claw.classList.remove('retracting');
                playBtn.disabled = false;

            } else {
                alert("You have to accept this one! It's destiny! ‚ú®");
            }
        }

        function accept() {
            spawnConfetti();
            
            document.getElementById('modalBtns').style.display = 'none';
            resultCard.style.border = "6px solid #FFD700"; 
            activityTitle.innerText = "YAY! HAVE FUN!";
            activityTitle.style.color = "#FF6B8B";
            activityDetails.innerHTML = ''; // Hide details on accept screen to keep it clean
            
            targetCapsuleElement.remove();
            heldCapsule.style.display = 'none';
            claw.classList.remove('retracting');
            playBtn.disabled = false;

            addToJournal(currentActivity);

            setTimeout(() => {
                modal.classList.remove('active');
            }, 3000);
        }

        function updateTokenDisplay() {
            tokenDisplay.innerText = tokens < 10 ? '0' + tokens : tokens;
        }

        // --- JOURNAL LOGIC ---
        function addToJournal(activity) {
            const entry = {
                id: Date.now(),
                text: activity.text,
                emoji: activity.emoji,
                date: new Date().toLocaleDateString(),
                rating: 0,
                note: ""
            };
            journalEntries.unshift(entry);
            saveJournal();
        }

        function saveJournal() {
            localStorage.setItem('morningMagicJournal', JSON.stringify(journalEntries));
            renderJournal();
        }

        function toggleJournal() {
            const el = document.getElementById('journalModal');
            el.classList.toggle('open');
            if(el.classList.contains('open')) renderJournal();
        }

        function renderJournal() {
            const list = document.getElementById('journalList');
            if(journalEntries.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#999; margin-top:50px;">Complete missions to fill your journal!</div>';
                return;
            }

            list.innerHTML = '';
            journalEntries.forEach(entry => {
                const div = document.createElement('div');
                div.className = 'journal-entry';
                
                let starsHtml = '';
                for(let i=1; i<=5; i++) {
                    starsHtml += `<span onclick="rateEntry(${entry.id}, ${i})">${i <= entry.rating ? '‚òÖ' : '‚òÜ'}</span>`;
                }

                div.innerHTML = `
                    <div class="entry-date">${entry.date}</div>
                    <div class="entry-title">${entry.emoji} ${entry.text}</div>
                    <div class="star-rating">${starsHtml}</div>
                    <textarea class="journal-note" placeholder="How was it? Write a note..." onchange="updateNote(${entry.id}, this.value)">${entry.note}</textarea>
                `;
                list.appendChild(div);
            });
        }

        window.rateEntry = (id, rating) => {
            const entry = journalEntries.find(e => e.id === id);
            if(entry) { entry.rating = rating; saveJournal(); }
        };

        window.updateNote = (id, text) => {
            const entry = journalEntries.find(e => e.id === id);
            if(entry) { entry.note = text; localStorage.setItem('morningMagicJournal', JSON.stringify(journalEntries)); }
        };


        // --- CONFETTI SYSTEM ---
        function spawnConfetti() {
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f'];
            for (let i = 0; i < 50; i++) {
                const conf = document.createElement('div');
                conf.classList.add('confetti');
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.background = colors[Math.floor(Math.random() * colors.length)];
                conf.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(conf);
                setTimeout(() => conf.remove(), 4000);
            }
        }

    </script>
</body>
</html>